# Chronos v1.1 发布说明

**发布日期**: 2025-10-21

## 🎉 版本概述

Chronos v1.1 是基于MVP用户验收测试（UAT）反馈的第一个迭代版本，主要聚焦于用户体验优化和系统文件管理改进。

---

## ✨ 新增功能

### 1. 系统文件自动忽略 🎯

**问题**: .DS_Store等系统文件会出现在文件列表中，导致无法正常回滚

**解决方案**:
- ✅ 自动创建.gitignore文件，包含跨平台系统文件规则
- ✅ 支持macOS、Windows、Linux、IDE配置文件的自动过滤
- ✅ 智能合并模式，保护用户已有的.gitignore配置
- ✅ 自动清理已追踪的系统文件
- ✅ 支持通过.chronos配置自定义规则

**影响范围**:
- 初始化仓库时自动创建.gitignore
- 文件状态列表自动过滤系统文件
- 已追踪文件列表自动过滤系统文件

### 2. 最近使用的仓库列表 📋

**问题**: 每次都需要手动输入路径，无法快速访问常用仓库

**解决方案**:
- ✅ 在欢迎页面显示最近使用的仓库（最多10个）
- ✅ 点击即可快速打开
- ✅ 支持从列表中删除不需要的记录
- ✅ 使用localStorage本地存储，重启后保留

**用户体验**:
- 快速访问常用仓库
- 无需重复输入路径
- 保持列表整洁

### 3. 停止服务脚本 🛑

**问题**: 只有启动脚本，没有停止脚本

**解决方案**:
- ✅ 创建了`stop-dev.sh`脚本
- ✅ 一键停止所有服务（Backend + Frontend）
- ✅ 自动清理残留进程

**使用方法**:
```bash
./stop-dev.sh
```

---

## 🔧 功能优化

### 4. 智能仓库打开 🧠

**优化前**:
- 两个按钮："打开现有仓库" 和 "初始化新仓库"
- 用户需要判断文件夹是否已初始化
- 功能重复，容易混淆

**优化后**:
- ✅ 只有一个"打开"按钮
- ✅ 智能识别：自动检测是否已初始化
- ✅ 未初始化 → 自动初始化
- ✅ 已初始化 → 直接打开
- ✅ 无需额外提示，流畅进入

### 5. 自动刷新数据 ⚡

**优化前**:
- 初始化或打开仓库后需要手动点击"刷新"按钮
- 额外的操作步骤

**优化后**:
- ✅ 打开仓库后自动加载文件列表
- ✅ 初始化后自动加载历史记录
- ✅ 自动加载分支信息
- ✅ 无需手动刷新

### 6. 创建分支后自动切换 🌿

**优化前**:
- 创建分支后需要手动切换到新分支

**优化后**:
- ✅ 创建分支后自动切换到新分支
- ✅ 减少操作步骤
- ✅ 更符合用户预期

### 7. 友好的错误提示 💬

**优化**:
- ✅ 路径不存在 → "当前文件目录不存在！"
- ✅ 权限问题 → "没有访问权限，请检查文件夹权限"
- ✅ 其他错误 → 显示具体错误信息
- ✅ 错误提示更清晰、更友好

---

## 🐛 Bug修复

### 系统文件显示问题
- **问题**: .DS_Store、.chronos、.gitignore等文件显示在界面中
- **修复**: 在`get_status()`和`get_tracked_files()`中过滤系统文件和Git管理文件

### 数据刷新问题
- **问题**: 打开仓库后数据不自动加载
- **修复**: 修复了异步状态更新导致的刷新失败问题

---

## 📊 技术改进

### Backend改进

**新增方法**:
- `_get_default_gitignore_rules()` - 获取默认忽略规则
- `_is_system_file()` - 判断是否为系统文件
- `_merge_gitignore_rules()` - 智能合并规则
- `_generate_gitignore_template()` - 生成模板
- `_create_or_update_gitignore()` - 创建或更新.gitignore
- `_cleanup_tracked_system_files()` - 清理已追踪的系统文件

**修改方法**:
- `init_repository()` - 集成.gitignore创建和系统文件清理
- `get_status()` - 过滤系统文件和Git管理文件
- `get_tracked_files()` - 过滤系统文件和Git管理文件

**新增常量**:
- `GITIGNORE_RULES` - 分类的忽略规则字典
- `SYSTEM_FILE_PATTERNS` - 系统文件检测正则表达式

### Frontend改进

**新增功能**:
- localStorage管理最近使用的仓库
- 智能错误提示
- 自动数据刷新

**新增类型**:
- `InitRepositoryData` - 初始化响应数据类型

**优化组件**:
- `App.tsx` - 简化Modal，添加最近仓库列表
- `BranchManager.tsx` - 创建分支后自动切换

---

## 📝 文档更新

### 用户文档
- ✅ 更新了USER_GUIDE.md，添加.gitignore说明
- ✅ 更新了FAQ.md，添加系统文件相关问题
- ✅ 更新了README.md，添加停止服务说明

### 开发文档
- ✅ 创建了测试脚本：test_gitignore.py
- ✅ 创建了诊断脚本：diagnose_repo.py
- ✅ 创建了修复脚本：fix_existing_repo.py
- ✅ 创建了测试仓库脚本：create_test_repo.sh

---

## 🧪 测试

### 自动化测试
- ✅ 所有单元测试通过
- ✅ .gitignore功能测试通过
- ✅ 系统文件检测测试通过
- ✅ Git状态过滤测试通过

### 手动测试
- ✅ 新仓库初始化测试通过
- ✅ 已有仓库兼容性测试通过
- ✅ 系统文件过滤测试通过
- ✅ 最近仓库列表测试通过

---

## 📈 性能影响

- ✅ 无性能下降
- ✅ 初始化速度保持毫秒级
- ✅ 文件过滤不影响响应速度

---

## 🔄 升级指南

### 对于新用户
直接使用即可，所有功能开箱即用。

### 对于已有仓库
如果你的仓库是在v1.0创建的，可以使用修复脚本：

```bash
# 为已有仓库添加.gitignore支持
python3 scripts/fix_existing_repo.py /path/to/your/repo
```

或者手动操作：
1. 在仓库根目录创建.gitignore文件
2. 添加系统文件规则
3. 运行`git rm --cached .DS_Store`清理已追踪的系统文件
4. 创建快照保存更改

---

## 🎯 UAT反馈处理

本版本完全基于UAT测试反馈，解决了所有6个优化建议：

| 编号 | 问题 | 状态 |
|------|------|------|
| 0 | 系统文件需要自动忽略 | ✅ 已完成 |
| 1 | 缺少停止服务脚本 | ✅ 已完成 |
| 2 | 重复初始化无提示 | ✅ 已完成 |
| 3 | 缺少仓库历史列表 | ✅ 已完成 |
| 4 | 初始化后需手动刷新 | ✅ 已完成 |
| 5 | 创建分支后需手动切换 | ✅ 已完成 |

---

## 🚀 下一步计划

### v1.2 计划
- 分支删除功能
- 快照搜索功能
- 性能监控面板
- 更多自定义配置选项

### 长期规划
- Tauri桌面应用
- Windows/Linux支持
- 远程仓库同步
- 协作功能

---

## 🙏 致谢

感谢所有参与UAT测试的用户，你们的反馈让Chronos变得更好！

特别感谢：
- UAT测试团队的详细反馈
- 社区用户的建议和支持

---

## 📞 反馈

如果你在使用v1.1时遇到任何问题，请：
- 提交GitHub Issue
- 查看FAQ文档
- 参与社区讨论

---

<div align="center">

**Chronos v1.1 - 更智能、更流畅、更好用**

Made with ❤️ by Chronos Team

</div>
