# PRD: “Chronos” (本地文件时光机) - v0.1 (MVP)

## 1. 产品概述
Chronos是一款面向非技术专业人士的轻量级本地文件版本管理工具。它以Git为核心引擎，通过直观的图形化界面，为用户提供强大的文件快照、历史追溯、版本回滚及分支管理等功能，旨在解决复杂文档项目中的版本混乱、协作低效和数据易失等核心痛点。

**产品形态**: 深度集成于操作系统的辅助工具 (MVP阶段优先实现macOS的右键菜单扩展)。

## 2. 用户场景与核心流程

### 2.1. 核心用户场景
1.  **单人模式 - 版本管理**: 用户希望对自己电脑上的一个重要项目文件夹（如“可行性研究报告”）进行版本控制，能够随时保存进度（快照），并在需要时安全地回退到任何历史版本。
2.  **单人模式 - 方案探索**: 用户在撰写主报告的同时，需要尝试一个完全不同的章节结构或写作思路。他希望能在不影响主报告的前提下，创建一个“B方案”副本进行自由探索，并在最终确认后，将“B方案”的成果合并回主报告。

### 2.2. 主业务流程 (Mermaid流程图)
```mermaid
graph TD
    A[用户选择一个普通文件夹] --> B{文件夹是否已为时光库?};
    B -- 否 --> C[右键 -> 启用时光机];
    C --> D[文件夹初始化为时光库];
    B -- 是 --> E[用户开始在文件夹内工作];
    D --> E;
    E --> F{有无重要阶段性成果?};
    F -- 否 --> E;
    F -- 是 --> G[右键 -> 创建快照];
    G --> H[填写快照描述并确认];
    H --> I[新版本被记录];
    I --> E;
    
    subgraph 探索与回滚 (可选分支流程)
        E --> J{需要回滚或探索新思路?};
        J -- 回滚 --> K[右键 -> 查看历史];
        K --> L[选择历史快照];
        L --> M[一键恢复到该版本];
        M --> E;
        J -- 探索新思路 --> N[右键/历史页 -> 创建分支];
        N --> O[在新分支上自由工作与创建快照];
        O --> P{探索完成?};
        P -- 是 --> Q[切换回主版本];
        Q --> R[发起合并];
        R --> S[确认合并，成果汇总];
        S --> E;
        P -- 否 --> O;
    end

    style D fill:#d4edda,stroke:#c3e6cb
    style I fill:#d4edda,stroke:#c3e6cb
    style S fill:#d4edda,stroke:#c3e6cb
```
*注意：以上业务流程仅供参考，具体开发可根据项目效率自行优化。*

## 3. 功能详述 (MVP范围)

### 3.1. 核心功能

#### 3.1.1. 初始化文件夹为“时光库” (git init)
- **用户故事**: 作为一个用户，我希望能选择任意一个本地文件夹，通过一次点击，将其“激活”为一个受Chronos保护的“时光库”。
- **交互流程**:
    1. 用户在Finder中右键点击一个普通文件夹。
    2. 在右键菜单中选择“Chronos” -> “启用时光机”。
    3. **引导与反馈**: 首次启用，弹窗简要说明这将如何保护该文件夹。成功后，应有明确的成功提示。
    4. Chronos在该文件夹内执行`git init`，并创建一个`.chronos`配置文件（用于存储Chronos特定设置）。
    5. 文件夹图标增加一个“时钟”角标，以视觉化标识其为“时光库”。
    6. **边缘案例**: 如果文件夹已是Git仓库，则菜单应显示为“已启用”，或提供“接管已有仓库”的选项。

#### 3.1.2. 创建快照 (git add & commit)
- **用户故事**: 我希望能为我的“时光库”在任意重要时刻创建一个带文字说明的“快照”，以便永久记录此刻的状态。
- **交互流程**:
    1. 用户右键点击“时光库”文件夹。
    2. 菜单中“创建快照”选项旁，通过一个数字角标实时提示有多少文件发生了改动（`git status --porcelain`）。
    3. 点击后，弹出一个简洁的悬浮窗口（见下方交互设计）。
    4. 窗口内包含：
        - 一个必填的文本输入框，用于“一句话描述 (Commit Message)”，有字数提示。
        - 一个可选的、可展开的详细描述文本区。
        - 一个清晰的文件列表，用不同颜色和图标标识“新增”、“修改”、“删除”的文件。
        - 一个“全选/取消全选”的复选框，允许用户只提交部分文件（高级功能）。
        - 一个“确认创建”按钮，仅在填写了一句话描述后激活。
    5. 用户填写描述后点击按钮，Chronos在后台执行`git add .`和`git commit -m "..."`。
    6. **引导与反馈**: 创建成功后，窗口关闭并弹出系统通知。如果未填写描述，按钮置灰并有提示。

#### 3.1.3. 查看历史 & 回滚 (git log & checkout)
- **用户故事**: 我希望能查看一个“时光库”的所有历史快照，并能安全地将整个文件夹恢复到任意一个历史状态。
- **交互流程**:
    1. 用户右键点击“时光库”文件夹，选择“查看历史”。
    2. 弹出一个历史浏览器窗口（见下方交互设计）。
    3. **空状态**: 如果是刚初始化的仓库，没有任何快照，界面会友好地引导用户去“创建第一个快照”。
    4. 窗口左侧是按时间倒序排列的垂直时间线，每一项都是一个快照（显示描述、作者、时间）。
    5. 点击任一快照，右侧区域会展示该快照相比其上一个版本的具体文件变化列表。
    6. 每个快照项旁边都有一个“恢复到此版本”的按钮。
    7. 点击后，Chronos会弹出**严重警告**模态框，告知用户“此操作将覆盖您当前所有未保存的修改，且不可逆，强烈建议先创建一次快照”。确认后，后台执行`git checkout <commit_id> -- .`。

#### 3.1.4. 分支管理 (git branch, switch, merge)
- **用户故事**: 我希望能在一个“时光库”的基础上，创建一个“草稿副本（分支）”来进行方案探索，成功后再合并回主版本。
- **交互流程**:
    1. 在“历史浏览器”窗口的顶部，有一个显示当前分支名称的下拉菜单。
    2. 点击下拉菜单，可以清晰地看到所有分支列表，并提供“新建分支”按钮。
    3. 用户可以“基于当前快照创建新分支”，并为其命名（如“B方案探索”）。
    4. 在下拉菜单中选择不同分支，即可在不同工作上下文间轻松切换（后台执行`git switch <branch>`）。
    5. 当处于非主分支（如“B方案探索”）时，“历史浏览器”顶部会显示一个醒目的“合并回主版本”按钮。
    6. 点击后，弹窗展示将要合并的改动列表，并提供“确认合并”按钮。合并成功或有冲突时，都给予清晰的反馈。

## 4. 交互设计 (ASCII Wireframes)
*注意：以下线框图仅为功能布局示意，非最终UI设计。具体开发可根据项目效率自行优化。*

### 4.1. 创建快照窗口
```
+-------------------------------------------+
| 创建快照 (青海数字政府项目)         [x] |
+-------------------------------------------+
|                                           |
|  一句话描述*                              |
| +---------------------------------------+ |
| |feat: 完成初步设计方案第一章主体内容   | |
| +---------------------------------------+ |
|                                           |
|  [+] 详细描述 (可选)                      |
|                                           |
|  变更文件 (3): [x] 全选                  |
| +---------------------------------------+ |
| | A  分册-1017.doc                      | |
| | M  总册-封面.ppt                      | |
| | D  旧的草稿.txt                       | |
| +---------------------------------------+ |
|                                           |
|                      +------------------+ |
|                      |  确认创建        | |
|                      +------------------+ |
+-------------------------------------------+
```

### 4.2. 历史浏览器窗口
```
+--------------------------------------------------------------------------+
| 历史记录: 青海数字政府项目  |  当前分支: [主版本 v]                 [合并回主版本] |
+--------------------------------------------------------------------------+
|                                           |                                |
|  * feat: 完成初步设计方案第一章主体内容     |  变更文件 (3):                   |
|    Alex | 1分钟前                       | +------------------------------+ |
|                                           | | A  分册-1017.doc           | |
|  * fix: 修正封面错别字                    | | M  总册-封面.ppt           | |
|    Alex | 2小时前          [恢复到此版本] | | D  旧的草稿.txt            | |
|                                           | +------------------------------+ |
|  * feat: 初始化项目文档结构               |                                |
|    Alex | 1天前           [恢复到此版本] |                                |
|                                           |                                |
+--------------------------------------------------------------------------+
```

## 5. 技术实现方案 (v0.1)
- **核心策略**: 采用**原生Git封装方案**，应用通过在后台执行Git命令行与`.git`仓库进行交互。
- **目标平台 (MVP)**: macOS
- **后端/核心逻辑**: **Python 3.10+** 搭配 **FastAPI**。
    - **理由**: Python拥有强大的胶水能力和丰富的库来执行子进程(`subprocess`)；FastAPI则能轻松构建一个本地Web服务，用于与前端GUI进行通信，逻辑清晰，易于扩展。
- **前端/GUI**: **Tauri** (使用 **React 18 + TypeScript + Vite** 技术栈)。
    - **理由**: Tauri能构建出体积小、性能高的原生桌面应用，完美契合我们“轻量级”的产品定位。React生态成熟，开发效率高。
- **UI设计**: 采用 **Ant Design 5.x** 组件库，保证界面美观与一致性，加速开发。
- **数据库**: MVP阶段**不引入**独立数据库。所有版本信息直接通过解析`git log`等命令的输出获得。用户信息和配置等可存储在本地JSON文件中。

## 6. 非功能性需求
- **性能**: 所有UI操作响应需在200ms以内，Git命令执行需有清晰的加载状态提示。
- **易用性**: 用户在不理解Git概念的情况下，仅通过“快照”、“历史”、“分支”等直观术语即可完成核心操作。
- **安全性**: 所有操作均为本地文件操作，不产生任何网络请求。
- **兼容性**: 需兼容主流的macOS版本 (Big Sur及以上)。
