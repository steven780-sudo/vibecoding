# 内置Git功能需求文档

## 概述

将Git二进制文件打包进Chronos应用，实现开箱即用，无需用户手动安装Git。

---

## 术语表

- **Bundled Git**: 打包在应用内的Git二进制文件
- **Portable Git**: 可移植的Git版本，无需安装即可运行
- **System Git**: 用户系统上安装的Git
- **Git Binary**: Git可执行文件及其依赖

---

## 需求

### 需求 1: 跨平台Git打包

**用户故事**: 作为Chronos用户，我希望在任何平台上安装应用后都能直接使用，无需额外安装Git。

#### 验收标准

1. WHEN 用户在macOS上安装Chronos，THE 应用 SHALL 包含完整的Git二进制文件（aarch64和x86_64）
2. WHEN 用户在Windows上安装Chronos，THE 应用 SHALL 包含完整的Git二进制文件（x64和x86）
3. WHEN 用户在Linux上安装Chronos，THE 应用 SHALL 包含完整的Git二进制文件（x86_64和aarch64）
4. WHEN 应用启动时，THE 应用 SHALL 自动检测并使用内置Git而不是系统Git
5. WHEN 内置Git不可用时，THE 应用 SHALL 回退到使用系统Git

### 需求 2: Git版本管理

**用户故事**: 作为开发者，我希望能够控制应用使用的Git版本，确保功能稳定性。

#### 验收标准

1. THE 应用 SHALL 使用Git 2.40+版本
2. WHEN 应用更新时，THE 应用 SHALL 能够更新内置的Git版本
3. THE 应用 SHALL 在启动时验证Git版本是否符合要求
4. WHEN Git版本验证失败时，THE 应用 SHALL 显示错误提示

### 需求 3: 资源优化

**用户故事**: 作为用户，我希望应用体积尽可能小，不影响下载和安装速度。

#### 验收标准

1. THE 内置Git SHALL 只包含核心命令，移除不必要的组件
2. THE 内置Git SHALL 使用压缩以减小体积
3. THE 应用安装包增加的体积 SHALL 不超过50MB
4. THE 应用 SHALL 在首次运行时解压Git二进制文件

### 需求 4: 许可证合规

**用户故事**: 作为项目维护者，我需要确保使用Git符合开源许可证要求。

#### 验收标准

1. THE 应用 SHALL 在关于页面显示Git的许可证信息（GPL v2）
2. THE 应用 SHALL 提供Git源代码的获取方式
3. THE 应用文档 SHALL 明确说明使用了Git及其版本
4. THE 应用 SHALL 遵守GPL v2的所有要求

### 需求 5: 降级策略

**用户故事**: 作为用户，如果内置Git出现问题，我希望应用能够使用系统Git作为备选。

#### 验收标准

1. WHEN 内置Git不可用时，THE 应用 SHALL 尝试使用系统Git
2. WHEN 系统Git可用时，THE 应用 SHALL 显示提示信息告知用户正在使用系统Git
3. WHEN 内置Git和系统Git都不可用时，THE 应用 SHALL 显示安装引导
4. THE 应用 SHALL 允许用户在设置中选择优先使用内置Git或系统Git

---

## 非功能需求

### 性能要求

- Git命令执行时间应与系统Git相当
- 首次启动解压Git的时间应小于3秒
- 应用启动时间增加不超过500ms

### 安全要求

- 内置Git二进制文件应从官方源下载
- 应验证下载文件的SHA256校验和
- 不应修改Git源代码

### 兼容性要求

- 支持macOS 10.13+
- 支持Windows 10+
- 支持主流Linux发行版（Ubuntu 20.04+, Fedora 35+等）

---

## 技术约束

1. Git二进制文件必须是便携版本（portable）
2. 必须包含Git所需的所有依赖库
3. 不能依赖系统环境变量
4. 必须支持多架构（x86_64, aarch64）

---

## 优先级

- P0（必须）: 需求1, 需求2, 需求4
- P1（重要）: 需求3, 需求5
- P2（可选）: 性能优化, 高级配置

---

## 风险评估

### 高风险
- **许可证合规**: Git使用GPL v2，需要确保合规
- **体积增加**: 可能影响用户下载意愿

### 中风险
- **跨平台兼容性**: 不同平台的Git依赖不同
- **维护成本**: 需要定期更新Git版本

### 低风险
- **性能影响**: 内置Git性能应与系统Git相当

---

## 成功标准

1. 90%以上用户无需手动安装Git即可使用Chronos
2. 应用安装包体积增加不超过50MB
3. 用户满意度调查中"安装便捷性"评分提升30%
4. 技术支持中关于Git安装的问题减少80%

---

**文档版本**: 1.0  
**创建日期**: 2025-10-22  
**状态**: 草稿
